<!DOCTYPE html>

<head>
  <link rel="stylesheet" href="style.css">
  <title>Code of Conduct: The Game</title>
</head>

<body>
  <h1 id="welcome">Welcome, <span id="name">---</span></h1>
  <p>
    <leaderboard>
      <div class="loader-container">
      	<div id="loader" class="loader"></div>
      </div>
      <table style="display: none;" id="leaderBoard">
        <tr>
          <th>Name</th>
          <th>Points</th>
        </tr>

      </table>
      
    </leaderboard>
    </div>


  </p>
  <button onclick="window.location.href='map.html'" class="play">PLAY</button>
  <button onclick="window.location.href='customization.html'" class="customization-button"><svg style="left: 0px; background-color: transparent;top: 0; position: absolute; height: smaller;" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px" fill="#FFFFFF"><rect fill="none" height="24" width="24"/><path d="M19.5,12c0-0.23-0.01-0.45-0.03-0.68l1.86-1.41c0.4-0.3,0.51-0.86,0.26-1.3l-1.87-3.23c-0.25-0.44-0.79-0.62-1.25-0.42 l-2.15,0.91c-0.37-0.26-0.76-0.49-1.17-0.68l-0.29-2.31C14.8,2.38,14.37,2,13.87,2h-3.73C9.63,2,9.2,2.38,9.14,2.88L8.85,5.19 c-0.41,0.19-0.8,0.42-1.17,0.68L5.53,4.96c-0.46-0.2-1-0.02-1.25,0.42L2.41,8.62c-0.25,0.44-0.14,0.99,0.26,1.3l1.86,1.41 C4.51,11.55,4.5,11.77,4.5,12s0.01,0.45,0.03,0.68l-1.86,1.41c-0.4,0.3-0.51,0.86-0.26,1.3l1.87,3.23c0.25,0.44,0.79,0.62,1.25,0.42 l2.15-0.91c0.37,0.26,0.76,0.49,1.17,0.68l0.29,2.31C9.2,21.62,9.63,22,10.13,22h3.73c0.5,0,0.93-0.38,0.99-0.88l0.29-2.31 c0.41-0.19,0.8-0.42,1.17-0.68l2.15,0.91c0.46,0.2,1,0.02,1.25-0.42l1.87-3.23c0.25-0.44,0.14-0.99-0.26-1.3l-1.86-1.41 C19.49,12.45,19.5,12.23,19.5,12z M12.04,15.5c-1.93,0-3.5-1.57-3.5-3.5s1.57-3.5,3.5-3.5s3.5,1.57,3.5,3.5S13.97,15.5,12.04,15.5z"/></svg></button>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
  https://firebase.google.com/docs/web/setup#available-libraries -->

  <script>

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDwrA0S_FEtAFZf_l262w5sP_LwXL-Ot9A",
      authDomain: "school-game-a48e9.firebaseapp.com",
      projectId: "school-game-a48e9",
      storageBucket: "school-game-a48e9.appspot.com",
      messagingSenderId: "387144751665",
      appId: "1:387144751665:web:bfc4a56b5d15e139b81310",
      measurementId: "G-68EC7BYK8W",
    };
    // Initialize Firebase
    var app = firebase.initializeApp(firebaseConfig);


    let provider = new firebase.auth.GoogleAuthProvider();


    function checkAuthState() {
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          document.querySelector("#name").innerText = user.displayName;
        } else {
          window.location.href = "./"
        }
      });
    }


    checkAuthState();


    // Initialize Firebase
    db = firebase.firestore(app);
    firebase.firestore().settings({
      cacheSizeBytes: firebase.firestore.CACHE_SIZE_UNLIMITED
    });



    const leaderBoard = document.querySelector("#leaderBoard");

    function renderCafe(doc) {
      let tr = document.createElement('tr');
      let name = document.createElement('td');
      let score = document.createElement('td');

      tr.setAttribute('data-id', doc.id);
      name.textContent = doc.data().name;
      score.textContent = doc.data().score;

      tr.appendChild(name);
      tr.appendChild(score);

      leaderBoard.appendChild(tr);
    }

    // real-time listener
    //snapshot an obj that represents your doc ..grab the data i t contains by calling data on it
    db.collection('players').orderBy('score', "desc").onSnapshot(snapshot => {
      document.getElementById('leaderBoard').style.display = 'inline-table' 
      document.getElementById('loader').style.display = 'none' 
      let changes = snapshot.docChanges();
      changes.forEach(change => {
        console.log(change.doc.data());
        if (change.type == 'added') {
          renderCafe(change.doc);
        }
      })
    })

// saving data
    // db.collection('players').add({
    //     name: name.value,
    //     score: parseInt(score.value)
    //     });




  </script>
  <script>

  </script>
</body>